[main]
  logdir            = /var/log/puppet
  vardir            = /var/lib/puppet
  ssldir            = /var/lib/puppet/ssl
  rundir            = /var/run/puppet
  factpath          = /var/lib/puppet/lib/facter

  # enable plugins sync (facts)
  pluginsync        = true
  configtimeout     = <%= scope.lookupvar('puppet::config_timeout') %>

[master]
  certname          = <%= @fqdn %>
<% case scope.lookupvar('puppet::dbadapter') when 'mysql' -%>
  storeconfigs      = true
  dbadapter         = 'mysql'
  dbuser            = <%= scope.lookupvar('puppet::dbuser') %>
  dbpassword        = <%= scope.lookupvar('puppet::dbpassword') %>
  dbserver          = <%= scope.lookupvar('puppet::dbserver') %>
  dbsocket          = '/var/run/mysqld/mysqld.sock'
<%  when 'sqlite3' -%>
  storeconfigs      = true
  dbadapter         = 'sqlite3'
<% when 'puppetdb' -%>
  storeconfigs         = true
  storeconfigs_backend = puppetdb
<% end %>

  reports           = <%= scope.lookupvar('puppet::reports') %>
<% if scope.lookupvar('puppet::reporturl') -%>
  reporturl = <%= scope.lookupvar('puppet::reporturl') %>
<% end -%>

   # These are needed when the puppetmaster is run by passenger
   # and can safely be removed if webrick is used.
   ssl_client_header = SSL_CLIENT_S_DN
   ssl_client_verify_header = SSL_CLIENT_VERIFY

<% scope.lookupvar('puppet::environments').each do |e, p| -%>
[<%= e -%>]
  modulepath        = <%= p['modules_path'] %>
  manifest          = <%= p['manifest_path'] %>
<% end -%>
