[main]
  logdir            = /var/log/puppet
  vardir            = /var/lib/puppet
  ssldir            = /var/lib/puppet/ssl
  rundir            = /var/run/puppet
  factpath          = /var/lib/puppet/lib/facter

  # enable plugins sync (facts)
  pluginsync        = true
  configtimeout     = 600

[master]
<%   case @dbadapter
      when 'mysql' -%>
     # MySQL stored configuration
  storeconfigs      = true
  dbadapter         = 'mysql'
  dbuser            = <%= @dbuser %>
  dbpassword        = <%= @dbpassword %>
  dbserver          = <%= @dbserver %>
  dbsocket          = <%= @dbsocket %>
<%  when 'sqlite3' -%>
  storeconfigs      = true
  dbadapter         = 'sqlite3'
<%   end %>
  certname          = <%= @certname %>
  <% if @dns_alt_names != 'UNDEF' -%>
  dns_alt_names     = <%= @dns_alt_names %>
  <% end -%>
  # reporting
  reports           = <%= reports %>
<% if reporturl -%>
  reporturl = <%= reporturl %>
<% end -%>

<% if @use_passenger -%>
   # These are needed when the puppetmaster is run by passenger
   # and can safely be removed if webrick is used.
   ssl_client_header = SSL_CLIENT_S_DN
   ssl_client_verify_header = SSL_CLIENT_VERIFY
<% end -%>

<% environment.each do |e, p| -%>
[<%= e -%>]
  modulepath        = <%= p['modules_path'] %>
  manifest          = <%= p['manifest_path'] %>
<% end -%>

<% if @add_agent -%>

[agent]
  # puppet master address
  server            = <%= @certname %>

  # synchronize fact
  pluginsync        = true

  # set environment
  environment       = production

  # enable reporting
  report            = true
  certname          = <%= @certname %>
<% if @configtimeout != 'UNDEF' -%>
  configtimeout     = <%= @configtimeout %>
<% end %>

<% end -%>
